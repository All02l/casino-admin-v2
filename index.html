<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg: #0f1216;
            --card-bg: #1e2329;
            --accent: #0088cc;
            --success: #00c853;
            --error: #ff3d00;
            --warning: #ffab00;
            --text-main: #ffffff;
            --text-dim: #90a4ae;
        }

        body { 
            color: var(--text-main); 
            background: var(--bg); 
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; 
            padding: 15px; 
            margin: 0; 
            overflow-x: hidden;
        }

        /* –ö—Ä–∞—Å–∏–≤—ã–π —Ñ–æ–Ω –Ω–∞ –∑–∞–¥–Ω–µ–º –ø–ª–∞–Ω–µ */
        body::before {
            content: "";
            position: fixed;
            top: -50px; right: -50px;
            width: 200px; height: 200px;
            background: var(--accent);
            filter: blur(100px);
            opacity: 0.15;
            z-index: -1;
        }

        .tabs { 
            display: flex; 
            gap: 8px; 
            margin-bottom: 20px; 
            background: rgba(255, 255, 255, 0.05); 
            padding: 6px; 
            border-radius: 16px; 
            backdrop-filter: blur(10px);
            position: sticky; 
            top: 10px; 
            z-index: 10;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .tab { 
            flex: 1; 
            padding: 12px 5px; 
            text-align: center; 
            border-radius: 12px; 
            cursor: pointer; 
            font-size: 11px; 
            font-weight: 600;
            color: var(--text-dim); 
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .tab.active { 
            background: var(--accent); 
            color: white; 
            box-shadow: 0 4px 15px rgba(0, 136, 204, 0.4);
            transform: translateY(-1px);
        }

        .card { 
            background: var(--card-bg); 
            padding: 18px; 
            border-radius: 20px; 
            margin-bottom: 15px; 
            border: 1px solid rgba(255, 255, 255, 0.05);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
            animation: slideIn 0.4s ease-out forwards;
            position: relative;
            overflow: hidden;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card::after {
            content: "";
            position: absolute;
            left: 0; top: 0; bottom: 0;
            width: 5px;
        }

        .card.deposit::after { background: var(--success); }
        .card.withdraw::after { background: var(--warning); }
        .card.server::after { background: var(--accent); }

        .header { 
            display: flex; 
            justify-content: space-between; 
            align-items: center;
            margin-bottom: 12px; 
        }

        .id-badge {
            background: rgba(255, 255, 255, 0.07);
            padding: 4px 10px;
            border-radius: 8px;
            font-size: 12px;
            font-family: monospace;
            color: var(--accent);
        }

        .status-badge { 
            font-size: 10px; 
            font-weight: 800;
            padding: 4px 8px; 
            border-radius: 6px; 
            background: rgba(0,0,0,0.3);
            letter-spacing: 1px;
        }

        .details { 
            color: var(--text-dim); 
            font-size: 14px; 
            line-height: 1.6; 
        }
        
        .details b { color: #fff; font-weight: 600; }
        .price-tag {
            display: inline-block;
            margin-top: 5px;
            color: var(--success);
            font-weight: 800;
            font-size: 16px;
        }

        .btn-group { display: flex; gap: 10px; margin-top: 18px; }
        
        .btn { 
            flex: 1; 
            border: none; 
            padding: 12px; 
            border-radius: 12px; 
            font-weight: 700; 
            cursor: pointer; 
            font-size: 13px; 
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }

        .btn-confirm { background: var(--success); color: white; }
        .btn-confirm:active { transform: scale(0.96); filter: brightness(1.2); }

        .btn-decline { background: rgba(231, 76, 60, 0.15); color: #ff5252; border: 1px solid rgba(255, 82, 82, 0.3); }
        .btn-decline:active { transform: scale(0.96); background: var(--error); color: white; }

        .btn-main { 
            background: linear-gradient(135deg, var(--accent), #00d2ff); 
            color: white; 
            width: 100%; 
            padding: 16px; 
            font-size: 16px; 
            margin-top: 10px; 
            border-radius: 16px;
            box-shadow: 0 5px 15px rgba(0, 136, 204, 0.3);
        }

        .empty { text-align: center; color: var(--text-dim); padding: 60px 0; font-style: italic; opacity: 0.5; }
        .hidden { display: none; }
    </style>
</head>
<body>
    <div class="tabs">
        <div id="t-deposits" class="tab active" onclick="show('deposits')">üì• –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ</div>
        <div id="t-withdraws" class="tab" onclick="show('withdraws')">üì§ –í—ã–≤–æ–¥</div>
        <div id="t-servers" class="tab" onclick="show('servers')">üñ• –°–µ—Ä–≤–µ—Ä–∞</div>
    </div>

    <div id="view-deposits">
        <div id="list-deposits"></div>
    </div>

    <div id="view-withdraws" class="hidden">
        <div id="list-withdraws"></div>
    </div>

    <div id="view-servers" class="hidden">
        <div id="list-servers"></div>
        <button class="btn btn-main" onclick="addServer()">‚ûï –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –Ω–æ–≤—ã–π —Å–µ—Ä–≤–µ—Ä</button>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.setHeaderColor('#0f1216');
        
        const params = new URLSearchParams(window.location.search);

        function show(tab) {
            document.querySelectorAll('[id^="view-"]').forEach(v => v.classList.add('hidden'));
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.getElementById('view-' + tab).classList.remove('hidden');
            document.getElementById('t-' + tab).classList.add('active');
            tg.HapticFeedback.impactOccurred('light');
        }

        function render() {
            const rawOrders = decodeURIComponent(params.get('chats') || "none");
            const rawServers = decodeURIComponent(params.get('data') || "none");

            const depList = document.getElementById('list-deposits');
            const wdrList = document.getElementById('list-withdraws');
            const serverList = document.getElementById('list-servers');

            if (rawOrders !== "none") {
                depList.innerHTML = ""; wdrList.innerHTML = "";
                rawOrders.split("|").forEach(order => {
                    const [id, name, amt, serv, status, type] = order.split(":"); 
                    const virt = amt * 20000;
                    const isWithdraw = (type === 'withdraw' || status.includes('withdraw'));

                    const html = `
                        <div class="card ${isWithdraw ? 'withdraw' : 'deposit'}">
                            <div class="header">
                                <span class="id-badge">#${id}</span>
                                <span class="status-badge" style="color: ${isWithdraw ? '#ffab00' : '#00c853'}">
                                    ${status.toUpperCase()}
                                </span>
                            </div>
                            <div class="details">
                                üë§ –ò–≥—Ä–æ–∫: <b>@${name}</b><br>
                                ${serv !== '0' && !isWithdraw ? `üéÆ –°–µ—Ä–≤–µ—Ä: <b>${serv}</b><br>` : ''}
                                ü™ô –°—É–º–º–∞: <b>${amt} –∫–æ–∏–Ω–æ–≤</b><br>
                                <span class="price-tag">üí∞ ${virt.toLocaleString()} –≤–∏—Ä—Ç</span>
                            </div>
                            ${status === 'pending' || status.includes('pending') ? `
                                <div class="btn-group">
                                    <button class="btn btn-confirm" onclick="send('${isWithdraw ? 'wdr_done' : 'confirm_dep'}:${id}')">–û–¥–æ–±—Ä–∏—Ç—å</button>
                                    <button class="btn btn-decline" onclick="send('${isWithdraw ? 'wdr_cancel' : 'decline_dep'}:${id}')">–û—Ç–∫–ª–æ–Ω–∏—Ç—å</button>
                                </div>
                            ` : ''}
                        </div>`;
                    
                    if (isWithdraw) wdrList.innerHTML += html;
                    else depList.innerHTML += html;
                });
            }

            if (!depList.innerHTML) depList.innerHTML = '<div class="empty">üì≠ –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–π –ø–æ–∫–∞ –Ω–µ—Ç</div>';
            if (!wdrList.innerHTML) wdrList.innerHTML = '<div class="empty">üì≠ –í—ã–≤–æ–¥–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</div>';

            if (rawServers !== "none") {
                serverList.innerHTML = rawServers.split("|").map(s => {
                    const [id, acc, nick] = s.split(":");
                    return `<div class="card server">
                        <div class="header"><span class="id-badge">SERVER ${id}</span></div>
                        <div class="details">
                            üí≥ –°—á–µ—Ç: <b>${acc}</b><br>
                            üë§ –ù–∏–∫: <b>${nick}</b>
                        </div>
                    </div>`;
                }).join("");
            } else {
                serverList.innerHTML = '<div class="empty">üñ• –°–µ—Ä–≤–µ—Ä–∞ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã</div>';
            }
        }

        function send(data) {
            tg.HapticFeedback.notificationOccurred('success');
            tg.sendData(data);
            tg.close();
        }

        function addServer() {
            const id = prompt("–ù–æ–º–µ—Ä —Å–µ—Ä–≤–µ—Ä–∞ (1-33):");
            const acc = prompt("–ù–æ–º–µ—Ä –±–∞–Ω–∫–æ–≤—Å–∫–æ–≥–æ —Å—á–µ—Ç–∞:");
            const name = prompt("–ò–≥—Ä–æ–≤–æ–π –Ω–∏–∫ (–ø–æ–ª—É—á–∞—Ç–µ–ª—å):");
            if (id && acc && name) send(`set_server:${id}|${acc}|${name}`);
        }

        render();
    </script>
</body>
</html>
