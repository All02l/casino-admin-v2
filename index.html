<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { color: white; background: #1c1c1c; font-family: sans-serif; padding: 15px; text-align: center; }
        .card { background: #2c2c2c; padding: 15px; border-radius: 10px; margin-bottom: 15px; }
        .grid { display: grid; grid-template-columns: repeat(11, 1fr); gap: 4px; margin: 10px 0; }
        .dot { height: 10px; border-radius: 2px; }
        .filled { background: #00ff00; }
        .empty { background: #ff4444; }
        .server-list { text-align: left; font-size: 13px; max-height: 200px; overflow-y: auto; background: #111; padding: 10px; border-radius: 5px; }
        .server-item { border-bottom: 1px solid #333; padding: 5px 0; }
        .server-item span { color: #0088cc; font-weight: bold; }
        button { background: #0088cc; color: white; border: none; padding: 12px; width: 100%; border-radius: 8px; font-weight: bold; margin-top: 10px; }
    </style>
</head>
<body>
    <h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ö–∞–∑–∏–Ω–æ üé∞</h2>

    <div class="card">
        <h3>üìä –ö–∞—Ä—Ç–∞ —Å–µ—Ä–≤–µ—Ä–æ–≤</h3>
        <div id="server-grid" class="grid"></div>
        
        <h3>üìã –†–µ–∫–≤–∏–∑–∏—Ç—ã –≤ –±–∞–∑–µ:</h3>
        <div id="details-list" class="server-list">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</div>
    </div>

    <div class="card">
        <button onclick="manageServers()">üñ• –ù–∞—Å—Ç—Ä–æ–∏—Ç—å / –ò–∑–º–µ–Ω–∏—Ç—å</button>
        <button onclick="changeRate()">üí∞ –ò–∑–º–µ–Ω–∏—Ç—å –∫—É—Ä—Å</button>
    </div>

    <script>
        let tg = window.Telegram.WebApp;
        tg.expand();

        const urlParams = new URLSearchParams(window.location.search);
        
        // 1. –†–∏—Å—É–µ–º —Å–µ—Ç–∫—É (—Ç–æ—á–∫–∏)
        const stats = urlParams.get('stats') || "0".repeat(33);
        const grid = document.getElementById('server-grid');
        for (let i = 0; i < 33; i++) {
            let dot = document.createElement('div');
            dot.className = 'dot ' + (stats[i] === '1' ? 'filled' : 'empty');
            grid.appendChild(dot);
        }

        // 2. –í—ã–≤–æ–¥–∏–º —Å–ø–∏—Å–æ–∫ —Ç–µ–∫—Å—Ç–æ–º
        const rawData = urlParams.get('data');
        const listDiv = document.getElementById('details-list');
        
        if (rawData && rawData !== "none") {
            listDiv.innerHTML = ""; // –û—á–∏—â–∞–µ–º
            const servers = rawData.split("|");
            servers.forEach(s => {
                const [id, acc, name] = s.split(":");
                listDiv.innerHTML += `<div class="server-item">üåê –°–µ—Ä–≤–µ—Ä <span>${id}</span>: –°—á—ë—Ç ${acc} (${name})</div>`;
            });
        }

        function manageServers() {
            let s = prompt("–ù–æ–º–µ—Ä —Å–µ—Ä–≤–µ—Ä–∞ (1-33):");
            if (!s || s < 1 || s > 33) return;
            let n = prompt("–ù–æ–º–µ—Ä —Å—á–µ—Ç–∞:");
            if (!n) return;
            let u = prompt("–ù–∏–∫ (–Ω–∞–∑–≤–∞–Ω–∏–µ):");
            if (!u) return;
            tg.sendData(`set_server:${s}|${n}|${u}`);
        }

        function changeRate() {
            let r = prompt("–ù–æ–≤—ã–π –∫—É—Ä—Å:");
            if (r) tg.sendData("set_rate:" + r);
        }
    </script>
</body>
</html>
