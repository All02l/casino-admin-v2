<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { color: white; background: #1c1c1c; font-family: sans-serif; padding: 15px; margin: 0; }
        .tabs { display: flex; gap: 10px; margin-bottom: 15px; }
        .tab { flex: 1; padding: 10px; text-align: center; background: #333; border-radius: 8px; cursor: pointer; font-size: 14px; }
        .tab.active { background: #0088cc; font-weight: bold; }
        
        .card { background: #2c2c2c; padding: 15px; border-radius: 10px; margin-bottom: 20px; border: 1px solid #444; }
        h3 { margin-top: 0; color: #0088cc; font-size: 16px; margin-bottom: 10px; }
        
        .list-container { max-height: 60vh; overflow-y: auto; }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–µ—Ä–≤–µ—Ä–æ–≤ */
        .server-item { background: #111; padding: 12px; margin-bottom: 8px; border-radius: 8px; border-left: 4px solid #0088cc; font-size: 13px; }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –ß–ê–¢–û–í (–∫–∞–∫ –Ω–∞ —Å–∫—Ä–∏–Ω–µ) */
        .chat-item { background: #1a1a1a; padding: 12px; margin-bottom: 8px; border-radius: 8px; border-bottom: 1px solid #333; display: flex; flex-direction: column; }
        .chat-item .user { font-weight: bold; color: #0088cc; font-size: 14px; margin-bottom: 4px; }
        .chat-item .msg { color: #ccc; font-size: 13px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .chat-item .time { font-size: 10px; color: #666; align-self: flex-end; }

        button { background: #0088cc; color: white; border: none; padding: 15px; width: 100%; border-radius: 10px; font-weight: bold; font-size: 16px; }
        .hidden { display: none; }
    </style>
</head>
<body>
    <div class="tabs">
        <div class="tab active" onclick="switchTab('servers')">üñ• –°–µ—Ä–≤–µ—Ä–∞</div>
        <div class="tab" onclick="switchTab('chats')">üí¨ –î–∏–∞–ª–æ–≥–∏</div>
    </div>

    <div id="tab-servers">
        <div class="card">
            <h3>–ê–∫—Ç–∏–≤–Ω—ã–µ —Å–µ—Ä–≤–µ—Ä–∞</h3>
            <div id="server-list" class="list-container">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        </div>
        <button onclick="addServer()">‚ûï –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Å–µ—Ä–≤–µ—Ä</button>
    </div>

    <div id="tab-chats" class="hidden">
        <div class="card">
            <h3>–ü–æ—Å–ª–µ–¥–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è</h3>
            <div id="chat-list" class="list-container">–ù–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π</div>
        </div>
        <p style="font-size: 12px; color: #666; text-align: center;">–ù–∞–∂–º–∏—Ç–µ –Ω–∞ —á–∞—Ç –≤ –±–æ—Ç–µ, —á—Ç–æ–±—ã –æ—Ç–≤–µ—Ç–∏—Ç—å</p>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.ready();

        const urlParams = new URLSearchParams(window.location.search);
        
        function switchTab(tab) {
            document.getElementById('tab-servers').classList.toggle('hidden', tab !== 'servers');
            document.getElementById('tab-chats').classList.toggle('hidden', tab !== 'chats');
            document.querySelectorAll('.tab').forEach(t => t.classList.toggle('active', t.innerText.toLowerCase().includes(tab === 'servers' ? '—Å–µ—Ä–≤–µ—Ä' : '–¥–∏–∞–ª–æ–≥')));
        }

        // –†–µ–Ω–¥–µ—Ä –°–ï–†–í–ï–†–û–í
        const rawData = urlParams.get('data');
        const serverList = document.getElementById('server-list');
        if (rawData && rawData !== "none") {
            serverList.innerHTML = rawData.split("|").map(s => {
                const [id, acc, name] = s.split(":");
                return `<div class="server-item">üÜî –°–µ—Ä–≤–µ—Ä: <b>${id}</b><br>üí≥ –°—á–µ—Ç: ${acc}<br>üë§ –ù–∏–∫: ${name}</div>`;
            }).join("");
        } else {
            serverList.innerHTML = "–°–µ—Ä–≤–µ—Ä–∞ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã";
        }

        // –†–µ–Ω–¥–µ—Ä –ß–ê–¢–û–í
        const chatsData = urlParams.get('chats');
        const chatList = document.getElementById('chat-list');
        if (chatsData && chatsData !== "none") {
            chatList.innerHTML = chatsData.split("|").map(c => {
                const [id, name, msg, time] = c.split(":");
                return `
                    <div class="chat-item">
                        <div class="user">@${name} (ID: ${id})</div>
                        <div class="msg">${msg}</div>
                        <div class="time">${time}</div>
                    </div>`;
            }).join("");
        }

        function addServer() {
            let id = prompt("–ù–æ–º–µ—Ä —Å–µ—Ä–≤–µ—Ä–∞:");
            let acc = prompt("–ù–æ–º–µ—Ä —Å—á–µ—Ç–∞:");
            let name = prompt("–ù–∏–∫:");
            if (id && acc && name) {
                tg.sendData(`set_server:${id}|${acc}|${name}`);
                tg.close();
            }
        }
    </script>
</body>
</html>
